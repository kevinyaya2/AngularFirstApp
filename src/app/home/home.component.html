<!-- 語言切換 -->
<div class="lang-switcher" role="group" aria-label="Language Switcher">
  <button mat-button (click)="switchLanguage('zh')" aria-label="切換中文">
    中文
  </button>
  <button mat-button (click)="switchLanguage('en')" aria-label="Switch to English">
    English
  </button>
</div>

<section>
  <form class="search-bar" role="search">
    <!-- 搜尋框 -->
    <input
      type="text"
      aria-label="搜尋關鍵字"
      [placeholder]="'SEARCH_PLACEHOLDER' | translate"
      (input)="onSearch($event)"
    />

    <!-- 城市選單 -->
    <mat-form-field appearance="outline" class="custom-select-field">
      <mat-label>{{ 'SELECT_CITY' | translate }}</mat-label>
      <mat-select
        (selectionChange)="onCitySelect($event.value)"
        aria-label="選擇城市"
      >
        <mat-option value="">{{ 'ALL' | translate }}</mat-option>
        <mat-option *ngFor="let city of cityList" [value]="city">
          {{ city }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </form>
</section>

<!-- Tabs -->
<mat-tab-group>
  <!-- 卡片模式 -->
  <mat-tab [label]="'CARD_MODE' | translate" aria-label="卡片模式">
    <section class="results">
      <app-housing-location
        *ngFor="let housingLocation of visibleLocations"
        [housingLocation]="housingLocation"
      ></app-housing-location>
    </section>

    <!-- 載入中 spinner -->
    <div *ngIf="isLoading" class="spinner-container" role="status" aria-live="polite">
      <mat-spinner diameter="40"></mat-spinner>
      <span class="visually-hidden">Loading...</span>
    </div>
  </mat-tab>

  <!-- 表格模式 -->
  <mat-tab [label]="'TABLE_MODE' | translate" aria-label="表格模式">
    <div class="search-row">
      <mat-form-field appearance="outline" class="custom-select-field">
        <mat-label>{{ 'SEARCH_INPUT' | translate }}</mat-label>
        <input
          type="text"
          aria-label="輸入名稱搜尋"
          matInput
          [formControl]="nameControl"
          [matAutocomplete]="auto"
        />
        <mat-autocomplete #auto="matAutocomplete">
          <mat-option
            *ngFor="let option of filteredOptions | async"
            [value]="option"
          >
            {{ option }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <button mat-raised-button color="primary" (click)="searchByName()" aria-label="執行搜尋">
        {{ 'SEARCH' | translate }}
      </button>
    </div>

    <table
      mat-table
      [dataSource]="dataSource"
      matSort
      cdkDropList
      (cdkDropListDropped)="drop($event)"
      class="mat-elevation-z8"
      aria-label="住房資料表格"
    >
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
        <td mat-cell *matCellDef="let element">{{ element.id }}</td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
        <td mat-cell *matCellDef="let element">{{ element.name }}</td>
      </ng-container>

      <ng-container matColumnDef="city">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>City</th>
        <td mat-cell *matCellDef="let element">{{ element.city }}</td>
      </ng-container>

      <ng-container matColumnDef="state">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>State</th>
        <td mat-cell *matCellDef="let element">{{ element.state }}</td>
      </ng-container>

      <ng-container matColumnDef="availableUnits">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Units</th>
        <td mat-cell *matCellDef="let element">
          {{ element.availableUnits }}
        </td>
      </ng-container>

      <ng-container matColumnDef="wifi">
        <th mat-header-cell *matHeaderCellDef>Wifi</th>
        <td mat-cell *matCellDef="let element">
          <i
            class="bi"
            [ngClass]="
              element.wifi
                ? 'bi-check-circle-fill text-success'
                : 'bi-x-circle-fill text-danger'
            "
            [attr.aria-label]="element.wifi ? '有 Wifi' : '無 Wifi'"
            role="img"
          ></i>
        </td>
      </ng-container>

      <ng-container matColumnDef="laundry">
        <th mat-header-cell *matHeaderCellDef>Laundry</th>
        <td mat-cell *matCellDef="let element">
          <i
            class="bi"
            [ngClass]="
              element.laundry
                ? 'bi-check-circle-fill text-success'
                : 'bi-x-circle-fill text-danger'
            "
            [attr.aria-label]="element.laundry ? '有洗衣設備' : '無洗衣設備'"
            role="img"
          ></i>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns" cdkDrag></tr>
    </table>
  </mat-tab>

  <!-- 地圖模式 -->
  <mat-tab [label]="'MAP_MODE' | translate" aria-label="地圖模式">
    <google-map
      height="500px"
      width="100%"
      [center]="mapCenter"
      [zoom]="7"
      aria-label="住房地圖"
    >
      <map-marker
        *ngFor="let h of housingLocationList"
        [position]="{ lat: h.latitude!, lng: h.longitude! }"
        [title]="h.name"
        [attr.aria-label]="h.name"
      ></map-marker>
    </google-map>
  </mat-tab>
</mat-tab-group>
